(()=>{"use strict";var t,e="",a=[],s=[],r={initThis:function(){var t=jQuery(".lsx-map:eq(0)"),a=Number(t.attr("data-lat")),s=Number(t.attr("data-long")),r=Number(t.attr("data-zoom")),o=t.attr("data-type");this.type=o;var n=Number(t.attr("data-height")),i=t.attr("data-class"),l=t.attr("data-icon"),u=t.attr("data-url"),p=t.attr("data-cluster-small"),m=t.attr("data-cluster-medium"),h=t.attr("data-cluster-large");"undefined"==p&&"undefined"==m&&"undefined"==h?this.cluster_disable=!0:(this.cluster_small=p,this.cluster_medium=m,this.cluster_large=h,this.cluster_disable=!1),this.fusion_tables_countries={},this.fusion_tables_colour_border=t.attr("data-fusion-tables-colour-border"),this.fusion_tables_width_border=t.attr("data-fusion-tables-width-border"),this.fusion_tables_colour_background=t.attr("data-fusion-tables-colour-background");var c=!1;this.framework_url=u,this.latlng=new google.maps.LatLng(a,s),this.icon_url=new google.maps.MarkerImage(l,null,null,null,new google.maps.Size(32,32)),this.bounds=[];var d=jQuery(i+":eq(0)");d.css("height",n),"route"===o&&"undefined"!==t.attr("data-kml")&&(c=t.attr("data-kml"));var g=null,f=null;"undefined"!=typeof SnazzyDataForSnazzyMaps&&void 0!==SnazzyDataForSnazzyMaps.json&&(g=jQuery.parseJSON(SnazzyDataForSnazzyMaps.json),f=new google.maps.StyledMapType(g,{name:"Styled Map"})),this.mapObj=new google.maps.Map(d[0],{zoom:r,maxZoom:21,minZoom:1,center:this.latlng,scrollwheel:!1,draggable:!0,mapTypeControl:!1,overviewMapControl:!1,panControl:!1,rotateControl:!1,mapTypeId:google.maps.MapTypeId.TERRAIN,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.TERRAIN,"map_style"]}}),null!==g&&null!==f&&(this.mapObj.mapTypes.set("map_style",f),this.mapObj.setMapTypeId("map_style")),0!=c&&null!=c?this.addRoute(c):(this.refreshMarkers(),"route"!=o||0!=c&&null!=c||this.drawRoute()),t.hasClass("disable-auto-zoom")||"cluster"!=o&&("route"!=o||0!=c&&null!=c)?this.setCenter():(1<this.bounds.length?this.setBounds():(this.latlng=this.bounds[0],console.log(this.latlng),this.setCenter()),d.css("height",n)),this.resizeThis(),e=this.mapObj},resizeThis:function(){google&&google.maps&&google.maps.event.trigger(this.mapObj,"resize")},drawRoute:function(){var t=[];jQuery(".lsx-map-markers").length>0&&jQuery(".lsx-map-markers .map-data").each(function(){t.push({lat:Number(jQuery(this).attr("data-lat")),lng:Number(jQuery(this).attr("data-long"))})}),new google.maps.Polyline({path:t,geodesic:!0,strokeColor:"#000000",strokeOpacity:1,strokeWeight:1.5}).setMap(this.mapObj)},generateRoute:function(){jQuery(".lsx-map-markers").length>0&&jQuery(".lsx-map-markers .map-data").each(function(){coordinates.push(jQuery(this).attr("data-lat")+" "+Number(jQuery(this).attr("data-long")))}),jQuery.get("https://roads.googleapis.com/v1/snapToRoads",{interpolate:!0,key:lsx_to_maps_params.apiKey,path:coordinates.join("|")},function(t){})},addFusionLayer:function(){jQuery("#script-fusion-tables").length>0&&jQuery("#script-fusion-tables").remove();var t=[];for(var e in this.fusion_tables_countries)t.push("'"+e+"'");var a=document.createElement("script"),s=["https://www.googleapis.com/fusiontables/v1/query?"],r="SELECT Name, geometry FROM 1N2LBk4JHwWpOY4d9fobIn27lfnZ5MDy-NoqqRpk WHERE Name IN ("+t.join()+")",o=encodeURIComponent(r),n=document.getElementsByTagName("body")[0];s.push("sql="),s.push(o),s.push("&callback=LSX_TO_Maps.drawFusionLayer"),s.push("&key="+lsx_to_maps_params.apiKey),a.id="script-fusion-tables",a.src=s.join(""),n.appendChild(a)},drawFusionLayer:function(a){var s=a.rows;for(var o in s){var n=[],i=s[o][1].geometries;if(i)for(var l in i)n.push(this.constructNewCoordinates(i[l]));else n=this.constructNewCoordinates(s[o][1].geometry);var u=new google.maps.Polygon({paths:n,strokeColor:this.fusion_tables_colour_border,strokeOpacity:.6,strokeWeight:this.fusion_tables_width_border,fillColor:this.fusion_tables_colour_background,fillOpacity:.3,countryName:s[o][0]});google.maps.event.addListener(u,"mouseover",function(){this.setOptions({fillOpacity:.6})}),google.maps.event.addListener(u,"mouseout",function(){this.setOptions({fillOpacity:.3})}),google.maps.event.addListener(u,"click",function(a){t&&t.close();var s=r.fusion_tables_countries[this.countryName];(t=new google.maps.InfoWindow({content:'<div class="lsx-to-map-marker"><img class="lsx-to-map-marker-img" src="'+s.thumbnail+'"><div class="lsx-to-map-marker-content content-area"><h4 class="lsx-to-map-marker-title">'+s.title+"</h4>"+s.content+'</div><br clear="all"/>'})).setPosition(a.latLng),t.open(e)}),u.setMap(this.mapObj)}},constructNewCoordinates:function(t){var e=[],a=t.coordinates[0];for(var s in a)e.push(new google.maps.LatLng(a[s][1],a[s][0]));return e},setCenter:function(){this.mapObj.setCenter(this.latlng)},refreshMarkers:function(){a=[],s=[],this.fusion_tables_countries={};var t=[],e=this;if(jQuery(".lsx-map-markers").length){var o=0,n=jQuery(".lsx-map-markers .map-data").length-1;jQuery(".lsx-map-markers .map-data").each(function(){var i=new google.maps.LatLng(Number(jQuery(this).attr("data-lat")),Number(jQuery(this).attr("data-long")));if(t.push(i),"1"===jQuery(this).attr("data-fusion-tables"))r.fusion_tables_countries[jQuery(this).attr("data-title")]={title:'<a href="'+jQuery(this).attr("data-link")+'">'+jQuery(this).attr("data-title")+"</a>",thumbnail:jQuery(this).attr("data-thumbnail"),content:jQuery(this).html()};else{a.push({marker:i,title:'<a target="_blank" rel="noopener noreferrer" href="'+jQuery(this).attr("data-link")+'">'+jQuery(this).attr("data-title")+"</a>",thumbnail:jQuery(this).attr("data-thumbnail"),content:jQuery(this).html()});var l=jQuery(this).attr("data-icon");console.log(l),console.log(o),console.log(n),"route"!=e.type||0!=o&&n!=o||(l=0==o?lsx_to_maps_params.start_marker:lsx_to_maps_params.end_marker),s.push(l),o++}});for(var i=0;i<a.length;i++)a[i]=this.createMarker(a[i],s[i]);if(this.bounds=t,1==this.cluster_disable&&"cluster"==this.type){var l={styles:[{url:this.cluster_small,height:52,width:53,anchor:[0,0],textColor:"#ffffff"},{url:this.cluster_medium,height:52,width:53,anchor:[0,0],textColor:"#ffffff"},{url:this.cluster_large,height:52,width:53,anchor:[0,0],textColor:"#ffffff"}]};new MarkerClusterer(this.mapObj,a,l)}Object.keys(r.fusion_tables_countries).length>0&&this.addFusionLayer()}},createMarker:function(a,s){console.log(a),console.log(jQuery(a.title).text());var r=new google.maps.Marker({position:a.marker,map:this.mapObj,title:jQuery(a.title).text(),icon:s});return r.addListener("click",function(){t&&t.close(),t=new google.maps.InfoWindow({title:jQuery(a.title).text(),label:jQuery(a.title).text(),content:'<div class="lsx-to-map-marker"><img class="lsx-to-map-marker-img" src="'+a.thumbnail+'"><div class="lsx-to-map-marker-content content-area"><h4 class="lsx-to-map-marker-title">'+a.title+"</h4>"+a.content+'</div><br clear="all"/>'}),google.maps.event.addListener(t,"domready",function(){window.setTimeout(function(){e.panBy(0,-30)},700)}),t.open(e,r)}),r},addRoute:function(t){console.log(t);var e=new google.maps.KmlLayer({url:t,map:this.mapObj});console.log(e),this.resizeThis()},setBounds:function(){if(google&&google.maps){for(var t=new google.maps.LatLngBounds,e=0;e<this.bounds.length;e++)t.extend(this.bounds[e]);this.mapObj.fitBounds(t)}},watchMapTriggers:function(){jQuery(".lsx-map-preview a").on("click",function(t){t.preventDefault(),jQuery.getScript(lsx_to_maps_params.google_url,function(){jQuery.getScript(lsx_to_maps_params.google_cluster_url),r.initThis()})})}};jQuery(document).ready(function(t){jQuery(".lsx-map").length>0&&(jQuery(".lsx-map").parents(".lsx-location-wrapper").find(".lsx-map-preview").length>0?r.watchMapTriggers():r.initThis())})})();